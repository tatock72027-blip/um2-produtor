<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>UM2 PRODUTOR ‚Äî IA STUDIO PRO</title>
  <style>
    :root {
      --primary: #ff2d55;
      --secondary: #4a9eff;
      --premium: #ffcc00;
      --bg: #0f0f1a;
      --card: #1a1a2e;
      --text: #ffffff;
      --accent: #ffcc00;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { 
      background: var(--bg); 
      color: var(--text); 
      padding: 20px; 
      position: relative;
      overflow-x: hidden;
      touch-action: manipulation;
    }

    /* üåå FUNDO 3D SISTEMA SOLAR */
    #solarSystem {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: radial-gradient(ellipse at center, #1a1a3a 0%, #00001a 100%);
      overflow: hidden;
    }
    
    .planet {
      position: absolute;
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(255,255,255,0.3);
      animation: float 20s infinite linear;
    }
    
    .sun {
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, #ffd700, #ff8c00);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 60px #ffcc00, inset 0 0 20px rgba(255,255,255,0.5);
    }
    
    .mercury { width: 20px; height: 20px; background: #a9a9a9; top: 45%; left: 40%; animation-duration: 8s; }
    .venus { width: 30px; height: 30px; background: #e6e6fa; top: 55%; left: 60%; animation-duration: 12s; }
    .earth { width: 35px; height: 35px; background: #1e90ff; top: 40%; left: 65%; animation-duration: 16s; }
    .mars { width: 25px; height: 25px; background: #ff4500; top: 60%; left: 45%; animation-duration: 20s; }
    .jupiter { width: 60px; height: 60px; background: #deb887; top: 30%; left: 30%; animation-duration: 30s; }
    
    @keyframes float {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    .container { 
      max-width: 600px; 
      margin: 0 auto; 
      background: var(--card); 
      padding: 30px; 
      border-radius: 16px; 
      position: relative;
      z-index: 10;
      backdrop-filter: blur(10px);
    }
    
    button { 
      background: var(--primary); 
      color: white; 
      border: none; 
      padding: 16px 28px;
      margin: 12px 0; 
      border-radius: 12px;
      font-size: 18px; 
      cursor: pointer; 
      width: 100%;
      transition: all 0.2s;
      min-height: 48px;
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
    button:disabled { background: #555; cursor: not-allowed; transform: none; }
    #upload, #recordBtn, #generateBeatBtn { background: var(--secondary); }
    #premiumBtn { background: var(--premium); color: #000; font-weight: bold; }
    #player, #beatPlayer, .stem-player { margin: 15px auto; width: 90%; display: none; }
    #payment, #download, #stemsSection, #lyricsSection { display: none; }
    
    /* üñºÔ∏è QR CODE AJUSTADO */
    #qrcode { 
      width: 220px; 
      height: 220px; 
      margin: 20px auto; 
      background: white; 
      padding: 15px; 
      border-radius: 16px; 
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .status { margin: 20px 0; font-weight: bold; color: var(--accent); }
    #pixInfo { background: #222; padding: 15px; border-radius: 8px; margin: 20px 0; font-size: 14px; word-break: break-all; }
    .hidden { display: none !important; }
    .badge { background: #ff3b30; color: white; padding: 5px 10px; border-radius: 20px; font-size: 14px; position: absolute; top: -10px; right: -10px; }
    .countdown { background: #333; padding: 15px; border-radius: 12px; margin: 15px 0; font-weight: bold; color: var(--accent); }
    .free-tag { background: #00c853; padding: 5px 10px; border-radius: 4px; font-size: 12px; margin-left: 10px; }
    .success-message { 
      background: rgba(0, 200, 83, 0.2); 
      padding: 15px; 
      border-radius: 12px; 
      margin: 20px 0; 
      font-weight: bold; 
      color: #00c853;
      display: none;
    }

    /* CONTROLES AVAN√áADOS */
    .control-group {
      background: rgba(255,255,255,0.05);
      padding: 15px;
      border-radius: 12px;
      margin: 15px 0;
    }
    
    .slider-container {
      margin: 15px 0;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: var(--accent);
    }
    
    input[type="range"] {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      background: #333;
      outline: none;
    }
    
    select {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      background: #2a2a3e;
      color: white;
      border: 1px solid #444;
      margin: 12px 0;
      min-height: 48px;
    }
    
    /* EDITOR DE LETRA */
    #lyricsEditor {
      width: 100%;
      height: 120px;
      padding: 15px;
      border-radius: 12px;
      background: rgba(255,255,255,0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
      margin: 15px 0;
      font-size: 16px;
    }
    
    /* STEMS GRID */
    .stems-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin: 20px 0;
    }
    
    .stem-card {
      background: rgba(255,255,255,0.05);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- üåå FUNDO 3D SISTEMA SOLAR -->
  <div id="solarSystem">
    <div class="planet sun"></div>
    <div class="planet mercury"></div>
    <div class="planet venus"></div>
    <div class="planet earth"></div>
    <div class="planet mars"></div>
    <div class="planet jupiter"></div>
  </div>

  <!-- ‚¨ÖÔ∏è BOT√ÉO DE VOLTAR -->
  <button id="backBtn" style="
    position: absolute;
    top: 20px;
    left: 20px;
    width: 48px;
    height: 48px;
    background: #555;
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 20px;
    cursor: pointer;
    z-index: 20;
    display: none;
    min-height: 48px;
  ">‚Üê</button>

  <!-- ‚¨ÜÔ∏è BOT√ÉO VOLTAR AO TOPO -->
  <button id="backToTop" style="
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 56px;
    height: 56px;
    background: #ff2d55;
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 24px;
    cursor: pointer;
    z-index: 100;
    opacity: 0;
    transition: opacity 0.3s;
    min-height: 56px;
  ">‚Üë</button>

  <div class="container">
    <div class="badge">üî• PRO</div>
    <h1>UM2 PRODUTOR</h1>
    <p>Produ√ß√£o profissional com IA ‚Äî sem login, sem cart√£o.</p>

    <!-- CONTADOR REGRESSIVO -->
    <div class="countdown" id="countdown">
      ‚è≥ Plano Ilimitado R$49 at√© <span id="endDate">--/--</span>
    </div>

    <!-- BOT√ÉO PLANO PREMIUM -->
    <button id="premiumBtn">üíé ASSINE ILIMITADO ‚Äî R$49/m√™s</button>

    <hr style="margin: 25px 0; opacity: 0.3;">

    <p>OU pague por m√∫sica:</p>
    
    <!-- ETAPA 1: UPLOAD OU GRAVA√á√ÉO -->
    <div id="step1">
      <!-- üéπ BOT√ÉO GERAR BEAT POR IA -->
      <button id="generateBeatBtn">üéπ Gerar Beat por IA</button>
      
      <input type="file" id="upload" accept="audio/*" />
      <p>OU</p>
      
      <!-- üéß PLAYER PARA OUVIR BEAT -->
      <audio id="beatPlayer" controls></audio>
      
      <!-- üéöÔ∏è CONTROLE DE VOLUME DO BEAT -->
      <div class="slider-container">
        <label>üîä Volume do Beat: <span id="beatVolumeValue">70</span>%</label>
        <input type="range" id="beatVolume" min="0" max="100" value="70">
      </div>
      
      <!-- üìù EDITOR DE LETRA -->
      <div class="control-group">
        <label>‚úçÔ∏è Letra da M√∫sica (opcional)</label>
        <textarea id="lyricsEditor" placeholder="Escreva sua letra aqui ou deixe em branco para gerar por IA..."></textarea>
      </div>
      
      <!-- üéõÔ∏è CONTROLES AVAN√áADOS DE IA -->
      <div class="control-group">
        <label>üéµ Estrutura da M√∫sica</label>
        <select id="structure">
          <option value="verso">Verso</option>
          <option value="refrao" selected>Refr√£o</option>
          <option value="ponte">Ponte</option>
        </select>
        
        <div class="slider-container">
          <label>‚ö° Energia: <span id="energyValue">70</span></label>
          <input type="range" id="energy" min="0" max="100" value="70">
        </div>
        
        <div class="slider-container">
          <label>üß© Complexidade: <span id="complexityValue">60</span></label>
          <input type="range" id="complexity" min="0" max="100" value="60">
        </div>
        
        <label>üéöÔ∏è Masteriza√ß√£o</label>
        <select id="mastering">
          <option value="balanced" selected>Equilibrado</option>
          <option value="clear">Claro</option>
          <option value="loud">Loud (Festival)</option>
        </select>
        
        <div class="slider-container">
          <label>üéöÔ∏è Tom (Pitch): <span id="pitchValue">0</span></label>
          <input type="range" id="pitch" min="-12" max="12" value="0">
        </div>
        
        <div class="slider-container">
          <label>‚è±Ô∏è Velocidade: <span id="tempoValue">100</span>%</label>
          <input type="range" id="tempo" min="50" max="200" value="100">
        </div>
      </div>
      
      <button id="recordBtn">üéôÔ∏è Gravar Minha Voz</button>
      <button id="nextBtn" disabled>‚û°Ô∏è Processar com IA Profissional</button>
    </div>

    <!-- ETAPA 2: PROCESSANDO -->
    <div id="processing" class="hidden">
      <p class="status">üìù Gerando letra profissional...</p>
    </div>

    <!-- ETAPA 3: OUVIR RESULTADO -->
    <div id="result" class="hidden">
      <p>‚úÖ Produ√ß√£o finalizada ‚Äî mixada e masterizada!</p>
      
      <!-- üéß PLAYER PRINCIPAL -->
      <audio id="player" controls></audio>
      
      <!-- üëÅÔ∏è STEMS SECTION -->
      <div id="stemsSection">
        <h3>üéß Stems Separadas (Demucs v4)</h3>
        <div class="stems-grid">
          <div class="stem-card">
            <p>Voz</p>
            <audio class="stem-player" id="vocalsPlayer" controls></audio>
          </div>
          <div class="stem-card">
            <p>Beat</p>
            <audio class="stem-player" id="accompanimentPlayer" controls></audio>
          </div>
          <div class="stem-card">
            <p>Bateria</p>
            <audio class="stem-player" id="drumsPlayer" controls></audio>
          </div>
          <div class="stem-card">
            <p>Baixo</p>
            <audio class="stem-player" id="bassPlayer" controls></audio>
          </div>
        </div>
      </div>
      
      <!-- üîÅ BOT√ÉO REPROCESSAR -->
      <button id="reprocessBtn">üîÑ Reprocessar com Novas Configura√ß√µes</button>
      
      <div id="payOrFree">
        <button id="payBtn">üí∞ Pagar R$11,00 e Baixar Tudo</button>
        <span class="free-tag" id="freeTag">Ilimitado para assinantes</span>
      </div>
    </div>

    <!-- ETAPA 4: PAGAMENTO -->
    <div id="payment" class="hidden">
      <p>üì≤ Pague via PIX para liberar download</p>
      <div id="pixInfo">Chave PIX: <strong>21977290154</strong></div>
      <div id="qrcode">
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=pix://21977290154" alt="QR Code PIX" />
      </div>
      <p>Ap√≥s pagar, clique em:</p>
      <button id="confirmPay">‚úÖ Confirmar Pagamento</button>
    </div>

    <!-- ETAPA 5: DOWNLOAD -->
    <div id="download" class="hidden">
      <p>üéâ Produ√ß√£o liberada! Baixe em alta qualidade:</p>
      
      <!-- üì§ DOWNLOAD DE STEMS -->
      <div class="stems-grid">
        <button id="downloadVocals">‚¨áÔ∏è Voz (WAV)</button>
        <button id="downloadAccompaniment">‚¨áÔ∏è Beat (WAV)</button>
        <button id="downloadDrums">‚¨áÔ∏è Bateria (WAV)</button>
        <button id="downloadBass">‚¨áÔ∏è Baixo (WAV)</button>
        <button id="downloadFullWav">‚¨áÔ∏è Full Mix (WAV)</button>
        <button id="downloadFullMp3">‚¨áÔ∏è Full Mix (MP3)</button>
      </div>
      
      <div class="success-message" id="successMessage">
        ‚úÖ Produ√ß√£o salva no seu dispositivo!
      </div>
      
      <p style="margin-top: 20px; font-size: 14px;">Assinante? Produza quantas m√∫sicas quiser! üöÄ</p>
    </div>
  </div>

  <script>
    // ELEMENTOS
    const upload = document.getElementById('upload');
    const recordBtn = document.getElementById('recordBtn');
    const nextBtn = document.getElementById('nextBtn');
    const processing = document.getElementById('processing');
    const result = document.getElementById('result');
    const player = document.getElementById('player');
    const beatPlayer = document.getElementById('beatPlayer');
    const payBtn = document.getElementById('payBtn');
    const payment = document.getElementById('payment');
    const confirmPay = document.getElementById('confirmPay');
    const download = document.getElementById('download');
    const step1 = document.getElementById('step1');
    const premiumBtn = document.getElementById('premiumBtn');
    const countdownEl = document.getElementById('countdown');
    const endDateEl = document.getElementById('endDate');
    const freeTag = document.getElementById('freeTag');
    const generateBeatBtn = document.getElementById('generateBeatBtn');
    const reprocessBtn = document.getElementById('reprocessBtn');
    const successMessage = document.getElementById('successMessage');
    const beatVolumeSlider = document.getElementById('beatVolume');
    const beatVolumeValue = document.getElementById('beatVolumeValue');
    const lyricsEditor = document.getElementById('lyricsEditor');

    // SLIDERS
    const energySlider = document.getElementById('energy');
    const energyValue = document.getElementById('energyValue');
    const complexitySlider = document.getElementById('complexity');
    const complexityValue = document.getElementById('complexityValue');
    const pitchSlider = document.getElementById('pitch');
    const pitchValue = document.getElementById('pitchValue');
    const tempoSlider = document.getElementById('tempo');
    const tempoValue = document.getElementById('tempoValue');

    // STEMS PLAYERS
    const vocalsPlayer = document.getElementById('vocalsPlayer');
    const accompanimentPlayer = document.getElementById('accompanimentPlayer');
    const drumsPlayer = document.getElementById('drumsPlayer');
    const bassPlayer = document.getElementById('bassPlayer');

    // DOWNLOAD BUTTONS
    const downloadVocals = document.getElementById('downloadVocals');
    const downloadAccompaniment = document.getElementById('downloadAccompaniment');
    const downloadDrums = document.getElementById('downloadDrums');
    const downloadBass = document.getElementById('downloadBass');
    const downloadFullWav = document.getElementById('downloadFullWav');
    const downloadFullMp3 = document.getElementById('downloadFullMp3');

    let audioBlob = null;
    let currentBeatUrl = null;
    let stemsGenerated = false;

    // DATA DO CARNAVAL 2026
    const offerEndDate = new Date('2026-02-15T23:59:59');
    endDateEl.innerText = offerEndDate.toLocaleDateString('pt-BR');

    // ATUALIZA VALORES DOS SLIDERS
    energySlider.addEventListener('input', () => {
      energyValue.textContent = energySlider.value;
    });
    
    complexitySlider.addEventListener('input', () => {
      complexityValue.textContent = complexitySlider.value;
    });
    
    pitchSlider.addEventListener('input', () => {
      pitchValue.textContent = pitchSlider.value;
    });
    
    tempoSlider.addEventListener('input', () => {
      tempoValue.textContent = tempoSlider.value + '%';
    });
    
    beatVolumeSlider.addEventListener('input', () => {
      beatVolumeValue.textContent = beatVolumeSlider.value;
      if (beatPlayer) {
        beatPlayer.volume = beatVolumeSlider.value / 100;
      }
    });

    // VERIFICA SE USU√ÅRIO J√Å √â ASSINANTE
    function checkPremium() {
      const premiumData = localStorage.getItem('um2_premium');
      if (premiumData) {
        const { expiry } = JSON.parse(premiumData);
        if (new Date() < new Date(expiry)) {
          return true;
        } else {
          localStorage.removeItem('um2_premium');
        }
      }
      return false;
    }

    // ATUALIZA INTERFACE SE FOR ASSINANTE
    function updateUIForPremium() {
      if (checkPremium()) {
        payBtn.classList.add('hidden');
        freeTag.classList.remove('hidden');
      } else {
        payBtn.classList.remove('hidden');
        freeTag.classList.add('hidden');
      }
    }

    // ASSINAR PLANO PREMIUM
    premiumBtn.addEventListener('click', () => {
      alert("üíé Assinatura ilimitada ativada por 30 dias ap√≥s pagamento de R$49!");
      const expiryDate = new Date();
      expiryDate.setDate(expiryDate.getDate() + 30);
      localStorage.setItem('um2_premium', JSON.stringify({
        subscribedAt: new Date(),
        expiry: expiryDate
      }));
      alert("‚úÖ Assinatura ativada! Produza quantas m√∫sicas quiser!");
      updateUIForPremium();
    });

    // UPLOAD DE BEAT
    upload.addEventListener('change', () => {
      if (upload.files.length > 0) {
        nextBtn.disabled = false;
        const fileURL = URL.createObjectURL(upload.files[0]);
        currentBeatUrl = fileURL;
        beatPlayer.src = fileURL;
        beatPlayer.style.display = "block";
      }
    });

    // üéπ GERAR BEAT POR IA
    generateBeatBtn.addEventListener('click', () => {
      const genre = document.getElementById('structure').value;
      const energy = energySlider.value;
      const complexity = complexitySlider.value;
      
      alert(`üéπ Gerando beat no estilo "${genre}" com energia ${energy} e complexidade ${complexity}...`);
      
      const fakeBeatUrl = "https://www.soundjay.com/misc/sounds/bell-ringing-05.wav";
      currentBeatUrl = fakeBeatUrl;
      beatPlayer.src = fakeBeatUrl;
      beatPlayer.style.display = "block";
      nextBtn.disabled = false;
      
      alert("‚úÖ Beat gerado com sucesso! Agora grave sua voz.");
    });

    // GRAVA√á√ÉO DE VOZ
    recordBtn.addEventListener('click', async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const mediaRecorder = new MediaRecorder(stream);
        const chunks = [];
        const isPremium = checkPremium();
        const maxDuration = isPremium ? 420000 : 234000;
        let startTime = Date.now();
        let timerInterval;

        let timerDisplay = document.createElement('div');
        timerDisplay.id = 'timer';
        timerDisplay.style.margin = '10px 0';
        timerDisplay.style.fontSize = '16px';
        timerDisplay.style.color = '#ffcc00';
        document.getElementById('step1').appendChild(timerDisplay);

        mediaRecorder.ondataavailable = e => chunks.push(e.data);
        mediaRecorder.onstop = () => {
          clearInterval(timerInterval);
          audioBlob = new Blob(chunks, { type: 'audio/wav' });
          nextBtn.disabled = false;
          stream.getTracks().forEach(track => track.stop());
          if (timerDisplay) timerDisplay.remove();
          alert(`‚úÖ Grava√ß√£o conclu√≠da! (${isPremium ? '7min' : '3min54s'})`);
        };

        mediaRecorder.start();

        timerInterval = setInterval(() => {
          let elapsed = Date.now() - startTime;
          let remaining = Math.max(0, Math.floor((maxDuration - elapsed) / 1000));
          if (timerDisplay) {
            timerDisplay.innerText = `‚è≥ Tempo restante: ${Math.floor(remaining / 60)}:${String(remaining % 60).padStart(2, '0')}`;
          }
          if (elapsed >= maxDuration) {
            mediaRecorder.stop();
          }
        }, 1000);

      } catch (err) {
        alert("Erro ao acessar microfone: " + err.message);
      }
    });

    // üìù GERAR LETRA (SIMULADO)
    function generateLyrics() {
      const userLyrics = lyricsEditor.value.trim();
      if (userLyrics) {
        return userLyrics;
      }
      
      const theme = document.getElementById('lyricsTheme')?.value || "amor e supera√ß√£o";
      const structure = document.getElementById('structure').value;
      return `Letra gerada por IA sobre ${theme} no estilo ${structure}.\n\n[Verso 1]\nEssa √© a primeira linha da letra...\n\n[Refr√£o]\nEsse √© o refr√£o emocionante...`;
    }

    // PROCESSAR COM IA (COM SEPARA√á√ÉO DE STEMS)
    function processWithAI() {
      step1.classList.add('hidden');
      processing.classList.remove('hidden');
      
      // Atualiza status com etapas de stems
      const stages = [
        "üìù Gerando letra profissional...",
        "üéπ Criando melodia e harmonia...",
        "üéôÔ∏è Processando sua voz...",
        "üîç Separando stems com Demucs v4...",
        "ü•Å Extraindo bateria...",
        "üé∏ Extraindo baixo...",
        "üéöÔ∏è Mixando todas as pistas...",
        "üîä Aplicando masteriza√ß√£o...",
        "‚úÖ Produ√ß√£o finalizada!"
      ];
      
      let stageIndex = 0;
      const statusElement = document.querySelector('.status');
      
      const interval = setInterval(() => {
        if (stageIndex < stages.length - 1) {
          statusElement.textContent = stages[stageIndex];
          stageIndex++;
        } else {
          clearInterval(interval);
          processing.classList.add('hidden');
          result.classList.remove('hidden');
          
          // √Åudio principal
          player.src = "https://www.soundjay.com/misc/sounds/bell-ringing-05.wav";
          player.style.display = "block";
          
          // Simula stems separadas
          vocalsPlayer.src = "https://www.soundjay.com/misc/sounds/bell-ringing-05.wav";
          accompanimentPlayer.src = "https://www.soundjay.com/misc/sounds/bell-ringing-05.wav";
          drumsPlayer.src = "https://www.soundjay.com/misc/sounds/bell-ringing-05.wav";
          bassPlayer.src = "https://www.soundjay.com/misc/sounds/bell-ringing-05.wav";
          
          // Mostra stems
          document.getElementById('stemsSection').style.display = "block";
          stemsGenerated = true;
          
          updateUIForPremium();
        }
      }, 1500);
    }

    nextBtn.addEventListener('click', processWithAI);

    // üîÅ REPROCESSAR COM NOVAS CONFIGURA√á√ïES
    reprocessBtn.addEventListener('click', () => {
      result.classList.add('hidden');
      step1.classList.remove('hidden');
      if (currentBeatUrl) {
        beatPlayer.src = currentBeatUrl;
        beatPlayer.style.display = "block";
      }
      if (audioBlob) {
        nextBtn.disabled = false;
      }
    });

    // PAGAR
    payBtn.addEventListener('click', () => {
      result.classList.add('hidden');
      payment.classList.remove('hidden');
    });

    // CONFIRMAR PAGAMENTO
    confirmPay.addEventListener('click', () => {
      payment.classList.add('hidden');
      localStorage.setItem('um2_paid_single', Date.now());
      download.classList.remove('hidden');
      alert("‚úÖ Pagamento confirmado! Em produ√ß√£o real, isso seria autom√°tico via webhook.");
    });

    // DOWNLOADS DE STEMS
    function createDownloadHandler(filename, type) {
      return () => {
        const isPremium = checkPremium();
        const hasPaid = localStorage.getItem('um2_paid_single');
        if (!isPremium && !hasPaid) {
          alert("‚ö†Ô∏è Pague R$11 ou assine o plano ilimitado para baixar.");
          payment.classList.remove('hidden');
          return;
        }
        downloadFile(filename, type);
        successMessage.style.display = "block";
      };
    }

    downloadVocals.addEventListener('click', createDownloadHandler("voz.wav", "audio/wav"));
    downloadAccompaniment.addEventListener('click', createDownloadHandler("beat.wav", "audio/wav"));
    downloadDrums.addEventListener('click', createDownloadHandler("bateria.wav", "audio/wav"));
    downloadBass.addEventListener('click', createDownloadHandler("baixo.wav", "audio/wav"));
    downloadFullWav.addEventListener('click', createDownloadHandler("producao_completa.wav", "audio/wav"));
    downloadFullMp3.addEventListener('click', createDownloadHandler("producao_completa.mp3", "audio/mpeg"));

    function downloadFile(filename, type) {
      const url = URL.createObjectURL(new Blob(["STEM AUDIO DATA - EM PRODU√á√ÉO SER√Å SUBSTITU√çDO POR √ÅUDIO REAL"], { type }));
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // AO CARREGAR
    window.addEventListener('load', () => {
      updateUIForPremium();
      const hasPaid = localStorage.getItem('um2_paid_single');
      const isPremium = checkPremium();
      if ((hasPaid || isPremium) && player.src) {
        download.classList.remove('hidden');
      }
    });

    // --- NOVAS FUN√á√ïES: BOT√ïES DE NAVEGA√á√ÉO ---
    const backBtn = document.getElementById('backBtn');
    const backToTop = document.getElementById('backToTop');

    function updateBackButton() {
      if (
        !processing.classList.contains('hidden') ||
        !result.classList.contains('hidden') ||
        !payment.classList.contains('hidden') ||
        !download.classList.contains('hidden')
      ) {
        backBtn.style.display = 'block';
      } else {
        backBtn.style.display = 'none';
      }
    }

    backBtn.addEventListener('click', () => {
      if (!processing.classList.contains('hidden')) {
        processing.classList.add('hidden');
        step1.classList.remove('hidden');
      } else if (!result.classList.contains('hidden')) {
        result.classList.add('hidden');
        step1.classList.remove('hidden');
      } else if (!payment.classList.contains('hidden')) {
        payment.classList.add('hidden');
        result.classList.remove('hidden');
      } else if (!download.classList.contains('hidden')) {
        download.classList.add('hidden');
        result.classList.remove('hidden');
      }
      updateBackButton();
    });

    const observer = new MutationObserver(updateBackButton);
    observer.observe(document.body, { childList: true, subtree: true });

    window.addEventListener('scroll', () => {
      if (window.scrollY > 300) {
        backToTop.style.opacity = '1';
      } else {
        backToTop.style.opacity = '0';
      }
    });

    backToTop.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    updateBackButton();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>UM2 PRODUTOR ‚Äî IA STUDIO PRO</title>
  <style>
    :root {
      --primary: #ff2d55;
      --secondary: #4a9eff;
      --premium: #ffcc00;
      --bg: #0f0f1a;
      --card: #1a1a2e;
      --text: #ffffff;
      --accent: #ffcc00;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { 
      background: var(--bg); 
      color: var(--text); 
      padding: 20px; 
      position: relative;
      overflow-x: hidden;
    }

    /* üåå FUNDO 3D SISTEMA SOLAR */
    #solarSystem {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: radial-gradient(ellipse at center, #1a1a3a 0%, #00001a 100%);
      overflow: hidden;
    }
    
    .planet {
      position: absolute;
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(255,255,255,0.3);
      animation: float 20s infinite linear;
    }
    
    .sun {
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, #ffd700, #ff8c00);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 60px #ffcc00, inset 0 0 20px rgba(255,255,255,0.5);
    }
    
    .mercury { width: 20px; height: 20px; background: #a9a9a9; top: 45%; left: 40%; animation-duration: 8s; }
    .venus { width: 30px; height: 30px; background: #e6e6fa; top: 55%; left: 60%; animation-duration: 12s; }
    .earth { width: 35px; height: 35px; background: #1e90ff; top: 40%; left: 65%; animation-duration: 16s; }
    .mars { width: 25px; height: 25px; background: #ff4500; top: 60%; left: 45%; animation-duration: 20s; }
    .jupiter { width: 60px; height: 60px; background: #deb887; top: 30%; left: 30%; animation-duration: 30s; }
    
    @keyframes float {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    .container { 
      max-width: 600px; 
      margin: 0 auto; 
      background: var(--card); 
      padding: 30px; 
      border-radius: 16px; 
      position: relative;
      z-index: 10;
      backdrop-filter: blur(10px);
    }
    
    button { 
      background: var(--primary); 
      color: white; 
      border: none; 
      padding: 14px 28px; 
      margin: 10px 0; 
      border-radius: 8px; 
      font-size: 18px; 
      cursor: pointer; 
      width: 100%;
      transition: all 0.2s;
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
    button:disabled { background: #555; cursor: not-allowed; transform: none; }
    #upload, #recordBtn { background: var(--secondary); }
    #premiumBtn { background: var(--premium); color: #000; font-weight: bold; }
    #player, #beatPlayer { margin: 20px auto; width: 90%; display: none; }
    #payment, #download { display: none; }
    
    /* üñºÔ∏è QR CODE AJUSTADO */
    #qrcode { 
      width: 220px; 
      height: 220px; 
      margin: 20px auto; 
      background: white; 
      padding: 15px; 
      border-radius: 16px; 
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .status { margin: 20px 0; font-weight: bold; color: var(--accent); }
    #pixInfo { background: #222; padding: 15px; border-radius: 8px; margin: 20px 0; font-size: 14px; word-break: break-all; }
    .hidden { display: none !important; }
    .badge { background: #ff3b30; color: white; padding: 5px 10px; border-radius: 20px; font-size: 14px; position: absolute; top: -10px; right: -10px; }
    .countdown { background: #333; padding: 10px; border-radius: 8px; margin: 15px 0; font-weight: bold; color: var(--accent); }
    .free-tag { background: #00c853; padding: 5px 10px; border-radius: 4px; font-size: 12px; margin-left: 10px; }

    /* CONTROLES AVAN√áADOS */
    .control-group {
      background: rgba(255,255,255,0.05);
      padding: 15px;
      border-radius: 12px;
      margin: 15px 0;
    }
    
    .slider-container {
      margin: 15px 0;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: var(--accent);
    }
    
    input[type="range"] {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      background: #333;
      outline: none;
    }
    
    select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      background: #2a2a3e;
      color: white;
      border: 1px solid #444;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <!-- üåå FUNDO 3D SISTEMA SOLAR -->
  <div id="solarSystem">
    <div class="planet sun"></div>
    <div class="planet mercury"></div>
    <div class="planet venus"></div>
    <div class="planet earth"></div>
    <div class="planet mars"></div>
    <div class="planet jupiter"></div>
  </div>

  <div class="container">
    <div class="badge">üî• PRO</div>
    <h1>UM2 PRODUTOR</h1>
    <p>Produ√ß√£o profissional com IA ‚Äî sem login, sem cart√£o.</p>

    <!-- CONTADOR REGRESSIVO -->
    <div class="countdown" id="countdown">
      ‚è≥ Plano Ilimitado R$49 at√© <span id="endDate">--/--</span>
    </div>

    <!-- BOT√ÉO PLANO PREMIUM -->
    <button id="premiumBtn">üíé ASSINE ILIMITADO ‚Äî R$49/m√™s</button>

    <hr style="margin: 25px 0; opacity: 0.3;">

    <p>OU pague por m√∫sica:</p>
    
    <!-- ETAPA 1: UPLOAD OU GRAVA√á√ÉO -->
    <div id="step1">
      <input type="file" id="upload" accept="audio/*" />
      <p>OU</p>
      
      <!-- üéß PLAYER PARA OUVIR BEAT -->
      <audio id="beatPlayer" controls></audio>
      
      <!-- üéõÔ∏è CONTROLES AVAN√áADOS DE IA -->
      <div class="control-group">
        <label>üéµ Estrutura da M√∫sica</label>
        <select id="structure">
          <option value="verso">Verso</option>
          <option value="refrao" selected>Refr√£o</option>
          <option value="ponte">Ponte</option>
        </select>
        
        <div class="slider-container">
          <label>‚ö° Energia: <span id="energyValue">70</span></label>
          <input type="range" id="energy" min="0" max="100" value="70">
        </div>
        
        <div class="slider-container">
          <label>üß© Complexidade: <span id="complexityValue">60</span></label>
          <input type="range" id="complexity" min="0" max="100" value="60">
        </div>
        
        <label>üéöÔ∏è Masteriza√ß√£o</label>
        <select id="mastering">
          <option value="balanced" selected>Equilibrado</option>
          <option value="clear">Claro</option>
          <option value="loud">Loud (Festival)</option>
        </select>
        
        <div class="slider-container">
          <label>üéöÔ∏è Tom (Pitch): <span id="pitchValue">0</span></label>
          <input type="range" id="pitch" min="-12" max="12" value="0">
        </div>
        
        <div class="slider-container">
          <label>‚è±Ô∏è Velocidade: <span id="tempoValue">100</span>%</label>
          <input type="range" id="tempo" min="50" max="200" value="100">
        </div>
      </div>
      
      <button id="recordBtn">üéôÔ∏è Gravar Minha Voz</button>
      <button id="nextBtn" disabled>‚û°Ô∏è Processar com IA Profissional</button>
    </div>

    <!-- ETAPA 2: PROCESSANDO -->
    <div id="processing" class="hidden">
      <p class="status">‚è≥ Gerando m√∫sica com IA avan√ßada...</p>
    </div>

    <!-- ETAPA 3: OUVIR RESULTADO -->
    <div id="result" class="hidden">
      <p>‚úÖ Produ√ß√£o finalizada ‚Äî mixada e masterizada!</p>
      <audio id="player" controls></audio>
      <div id="payOrFree">
        <button id="payBtn">üí∞ Pagar R$11,00 e Baixar WAV + MP3</button>
        <span class="free-tag" id="freeTag">Ilimitado para assinantes</span>
      </div>
    </div>

    <!-- ETAPA 4: PAGAMENTO -->
    <div id="payment" class="hidden">
      <p>üì≤ Pague via PIX para liberar download</p>
      <div id="pixInfo">Chave PIX: <strong>21977290154</strong></div>
      <div id="qrcode">
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=pix://21977290154" alt="QR Code PIX" />
      </div>
      <p>Ap√≥s pagar, clique em:</p>
      <button id="confirmPay">‚úÖ Confirmar Pagamento</button>
    </div>

    <!-- ETAPA 5: DOWNLOAD -->
    <div id="download" class="hidden">
      <p>üéâ Produ√ß√£o liberada! Baixe em alta qualidade:</p>
      <button id="downloadWav">‚¨áÔ∏è Baixar WAV (Masterizado)</button>
      <button id="downloadMp3">‚¨áÔ∏è Baixar MP3 (Para Redes)</button>
      <p style="margin-top: 20px; font-size: 14px;">Assinante? Produza quantas m√∫sicas quiser! üöÄ</p>
    </div>
  </div>

  <script>
    // ELEMENTOS
    const upload = document.getElementById('upload');
    const recordBtn = document.getElementById('recordBtn');
    const nextBtn = document.getElementById('nextBtn');
    const processing = document.getElementById('processing');
    const result = document.getElementById('result');
    const player = document.getElementById('player');
    const beatPlayer = document.getElementById('beatPlayer');
    const payBtn = document.getElementById('payBtn');
    const payment = document.getElementById('payment');
    const confirmPay = document.getElementById('confirmPay');
    const download = document.getElementById('download');
    const downloadWav = document.getElementById('downloadWav');
    const downloadMp3 = document.getElementById('downloadMp3');
    const step1 = document.getElementById('step1');
    const premiumBtn = document.getElementById('premiumBtn');
    const countdownEl = document.getElementById('countdown');
    const endDateEl = document.getElementById('endDate');
    const freeTag = document.getElementById('freeTag');

    // SLIDERS
    const energySlider = document.getElementById('energy');
    const energyValue = document.getElementById('energyValue');
    const complexitySlider = document.getElementById('complexity');
    const complexityValue = document.getElementById('complexityValue');
    const pitchSlider = document.getElementById('pitch');
    const pitchValue = document.getElementById('pitchValue');
    const tempoSlider = document.getElementById('tempo');
    const tempoValue = document.getElementById('tempoValue');

    let audioBlob = null;

    // DATA DO CARNAVAL 2026
    const offerEndDate = new Date('2026-02-15T23:59:59');
    endDateEl.innerText = offerEndDate.toLocaleDateString('pt-BR');

    // ATUALIZA VALORES DOS SLIDERS
    energySlider.addEventListener('input', () => {
      energyValue.textContent = energySlider.value;
    });
    
    complexitySlider.addEventListener('input', () => {
      complexityValue.textContent = complexitySlider.value;
    });
    
    pitchSlider.addEventListener('input', () => {
      pitchValue.textContent = pitchSlider.value;
    });
    
    tempoSlider.addEventListener('input', () => {
      tempoValue.textContent = tempoSlider.value + '%';
    });

    // VERIFICA SE USU√ÅRIO J√Å √â ASSINANTE
    function checkPremium() {
      const premiumData = localStorage.getItem('um2_premium');
      if (premiumData) {
        const { expiry } = JSON.parse(premiumData);
        if (new Date() < new Date(expiry)) {
          return true;
        } else {
          localStorage.removeItem('um2_premium');
        }
      }
      return false;
    }

    // ATUALIZA INTERFACE SE FOR ASSINANTE
    function updateUIForPremium() {
      if (checkPremium()) {
        payBtn.classList.add('hidden');
        freeTag.classList.remove('hidden');
      } else {
        payBtn.classList.remove('hidden');
        freeTag.classList.add('hidden');
      }
    }

    // ASSINAR PLANO PREMIUM
    premiumBtn.addEventListener('click', () => {
      alert("üíé Assinatura ilimitada ativada por 30 dias ap√≥s pagamento de R$49!");
      const expiryDate = new Date();
      expiryDate.setDate(expiryDate.getDate() + 30);
      localStorage.setItem('um2_premium', JSON.stringify({
        subscribedAt: new Date(),
        expiry: expiryDate
      }));
      alert("‚úÖ Assinatura ativada! Produza quantas m√∫sicas quiser!");
      updateUIForPremium();
    });

    // UPLOAD DE BEAT
    upload.addEventListener('change', () => {
      if (upload.files.length > 0) {
        nextBtn.disabled = false;
        const fileURL = URL.createObjectURL(upload.files[0]);
        beatPlayer.src = fileURL;
        beatPlayer.style.display = "block";
      }
    });

    // GRAVA√á√ÉO DE VOZ
    recordBtn.addEventListener('click', async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const mediaRecorder = new MediaRecorder(stream);
        const chunks = [];
        const isPremium = checkPremium();
        const maxDuration = isPremium ? 420000 : 234000;
        let startTime = Date.now();
        let timerInterval;

        let timerDisplay = document.createElement('div');
        timerDisplay.id = 'timer';
        timerDisplay.style.margin = '10px 0';
        timerDisplay.style.fontSize = '16px';
        timerDisplay.style.color = '#ffcc00';
        document.getElementById('step1').appendChild(timerDisplay);

        mediaRecorder.ondataavailable = e => chunks.push(e.data);
        mediaRecorder.onstop = () => {
          clearInterval(timerInterval);
          audioBlob = new Blob(chunks, { type: 'audio/wav' });
          nextBtn.disabled = false;
          stream.getTracks().forEach(track => track.stop());
          if (timerDisplay) timerDisplay.remove();
          alert(`‚úÖ Grava√ß√£o conclu√≠da! (${isPremium ? '7min' : '3min54s'})`);
        };

        mediaRecorder.start();

        timerInterval = setInterval(() => {
          let elapsed = Date.now() - startTime;
          let remaining = Math.max(0, Math.floor((maxDuration - elapsed) / 1000));
          if (timerDisplay) {
            timerDisplay.innerText = `‚è≥ Tempo restante: ${Math.floor(remaining / 60)}:${String(remaining % 60).padStart(2, '0')}`;
          }
          if (elapsed >= maxDuration) {
            mediaRecorder.stop();
          }
        }, 1000);

      } catch (err) {
        alert("Erro ao acessar microfone: " + err.message);
      }
    });

    // PROCESSAR COM IA
    nextBtn.addEventListener('click', () => {
      step1.classList.add('hidden');
      processing.classList.remove('hidden');

      setTimeout(() => {
        processing.classList.add('hidden');
        result.classList.remove('hidden');
        player.src = "https://www.soundjay.com/misc/sounds/bell-ringing-05.wav";
        player.style.display = "block";
        updateUIForPremium();
      }, 3000);
    });

    // PAGAR
    payBtn.addEventListener('click', () => {
      result.classList.add('hidden');
      payment.classList.remove('hidden');
    });

    // CONFIRMAR PAGAMENTO
    confirmPay.addEventListener('click', () => {
      payment.classList.add('hidden');
      localStorage.setItem('um2_paid_single', Date.now());
      download.classList.remove('hidden');
      alert("‚úÖ Pagamento confirmado! Em produ√ß√£o real, isso seria autom√°tico via webhook.");
    });

    // DOWNLOADS
    downloadWav.addEventListener('click', () => {
      const isPremium = checkPremium();
      const hasPaid = localStorage.getItem('um2_paid_single');
      if (!isPremium && !hasPaid) {
        alert("‚ö†Ô∏è Pague R$11 ou assine o plano ilimitado para baixar.");
        payment.classList.remove('hidden');
        return;
      }
      downloadFile("producao_um2.wav", "audio/wav");
    });

    downloadMp3.addEventListener('click', () => {
      const isPremium = checkPremium();
      const hasPaid = localStorage.getItem('um2_paid_single');
      if (!isPremium && !hasPaid) {
        alert("‚ö†Ô∏è Pague R$11 ou assine o plano ilimitado para baixar.");
        payment.classList.remove('hidden');
        return;
      }
      downloadFile("producao_um2.mp3", "audio/mpeg");
    });

    function downloadFile(filename, type) {
      const url = URL.createObjectURL(new Blob(["IA PRODUCTION - EM PRODU√á√ÉO SER√Å SUBSTITU√çDO POR √ÅUDIO REAL"], { type }));
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // AO CARREGAR
    window.addEventListener('load', () => {
      updateUIForPremium();
      const hasPaid = localStorage.getItem('um2_paid_single');
      const isPremium = checkPremium();
      if ((hasPaid || isPremium) && player.src) {
        download.classList.remove('hidden');
      }
    });
  </script>
</body>
  </html>
